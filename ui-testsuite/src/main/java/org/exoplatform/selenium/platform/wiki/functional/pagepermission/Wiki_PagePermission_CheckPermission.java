package org.exoplatform.selenium.platform.wiki.functional.pagepermission;

import static org.exoplatform.selenium.TestLogger.info;

import org.exoplatform.selenium.Dialog;
import org.exoplatform.selenium.platform.ManageAccount;
import org.exoplatform.selenium.platform.wiki.Permalink;
import org.openqa.selenium.By;
import org.testng.annotations.*;

public class Wiki_PagePermission_CheckPermission extends Permalink{

	ManageAccount magAc;
	Dialog dialog;

	@BeforeMethod
	public void beforeTest(){
		initSeleniumTest();
		driver.get(baseUrl);
		magAc = new ManageAccount(driver);
		magAc.signIn(DATA_USER1, DATA_PASS);
		dialog = new Dialog(driver);
		goToWiki();
	}

	@AfterMethod
	public void afterTest(){
		//signOut();
		driver.manage().deleteAllCookies();
		driver.quit();
	}

	/**
	 *Case ID:118248.
	 *Test Case Name: Verify Edit permission for a user.
	 *Pre-Condition: - wiki page PageA already is created
	- User A has permissions on PageA: View Pages, Edit Pages in Page Permissions
	- User A does not belong to any group who has Edit Pages in Page Permissions
	 *Post-Condition: 
	 *Done with OSs and browsers : 
	 *Generated by phuongdt at 2014/09/18 14:17:25
	 */
	@Test
	public  void test01_VerifyEditPermissionForAUser() {
		info("Test 1: Verify Edit permission for a user");
		String title = "title118248";
		String content = "content118248";
		String user = DATA_USER3;
		String[] userGroup = {user};

		info("Add a wiki page");
		goToWiki();
		addBlankWikiPage(title, content, 0);

		info("Add user has permission default");
		deletePagePermission("any");
		waitForElementNotPresent(ELEMENT_PAGE_PERMISSION_POPUP);
		addPagePermission(1, userGroup);
		waitForElementNotPresent(ELEMENT_PAGE_PERMISSION_POPUP);

		info("Add edit page permission for " + user);
		editPagePermission(user, true, false);

		info("Check user can not edit wiki page");
		magAc.signOut();
		magAc.signIn(user, DATA_PASS);
		goToWiki();
		goToWikiPage(title);
		waitForElementNotPresent(ELEMENT_EDIT_PAGE_LINK);
		waitForElementNotPresent(ELEMENT_ADD_PAGE_LINK);
		click(ELEMENT_MORE_LINK);
		waitForElementNotPresent(ELEMENT_DELETE_LINK);
		waitForElementNotPresent(ELEMENT_MOVE_PAGE_LINK);

		magAc.signOut();
		magAc.signIn(DATA_USER1, DATA_PASS);

		/*Step Number: 1
		 *Step Name: Step 1: Open Page Permissions form
		 *Step Description: 
			- Open the wiki page PageA
			- Go to More 
			-
			-> Page Permissions
		 *Input Data: 

		 *Expected Outcome: 
			Page Permissions form displays*/

		/*Step number: 2
		 *Step Name: Step 2: Delete Edit Pages permission for User A
		 *Step Description: 
			- Check the User A permission
			- In the permission table, untick the Edit Pages checkbox of the User A
			- Click Save
		 *Input Data: 

		 *Expected Outcome: 
			- Edit Pages checkbox is deselected*/
		goToWikiPage("Wiki Home/" + title, ManageAccount.userType.ADMIN);
		editPagePermission(user, true, true);
		magAc.signOut();

		/*Step number: 3
		 *Step Name: Step 3: Check if the User A has Edit Pages permission
		 *Step Description: 
			- Login as User A
			- Go to space 
			-
			-> Wiki
			- Select PageA
		 *Input Data: 

		 *Expected Outcome: 
			- The user A can view the wiki page PageA but cannot see Edit Page, Add Page; Move Page and Delete Page from More menu*/ 
		magAc.signIn(user, DATA_PASS);
		goToWiki();
		goToWikiPage(title);
		waitForAndGetElement(ELEMENT_EDIT_PAGE_LINK);
		waitForAndGetElement(ELEMENT_ADD_PAGE_LINK);
		click(ELEMENT_MORE_LINK);
		waitForAndGetElement(ELEMENT_DELETE_LINK);
		waitForAndGetElement(ELEMENT_MOVE_PAGE_LINK);

		//Clear data
		info("Clear data");
		String[] wikiPath = {"Wiki Home/" + title};
		resetDataByDeleteWikiPage(ManageAccount.userType.ADMIN, wikiPath);
	}

	/**
	 *Case ID:118249.
	 *Test Case Name: Verify Edit permission for a group.
	 *Pre-Condition: - wiki page PageA already is created
	- Group A already has permissions on the wiki page PageA: View Pages, Edit Pages in Page Permissions
	- Member of Group A does not belong to any groups who have Edit Pages permission in Page Permissions
	- Member of Group A does not have Edit Pages permission in Page Permissions
	 *Post-Condition: 
	 *Done with OSs and browsers : 
	 *Generated by phuongdt at 2014/09/18 14:17:25
	 */
	@Test
	public  void test02_VerifyEditPermissionForAGroup() {
		info("Test 2: Verify Edit permission for a group");
		String title = "title118249";
		String content = "content118249";
		String user = DATA_USER3;
		String path = "*:/organization/employees";
		String[] userGroup = {path};

		info("Add a wiki page");
		goToWiki();
		addBlankWikiPage(title, content, 0);

		info("Add user has permission default");
		deletePagePermission("any");
		waitForElementNotPresent(ELEMENT_PAGE_PERMISSION_POPUP);
		addPagePermission(0, userGroup);
		waitForElementNotPresent(ELEMENT_PAGE_PERMISSION_POPUP);

		info("Add edit page permission for " + user);
		editPagePermission(path, true, false);

		info("Check user can not edit wiki page");
		magAc.signOut();
		magAc.signIn(user, DATA_PASS);
		goToWiki();
		goToWikiPage(title);
		waitForElementNotPresent(ELEMENT_EDIT_PAGE_LINK);
		waitForElementNotPresent(ELEMENT_ADD_PAGE_LINK);
		click(ELEMENT_MORE_LINK);
		waitForElementNotPresent(ELEMENT_DELETE_LINK);
		waitForElementNotPresent(ELEMENT_MOVE_PAGE_LINK);

		magAc.signOut();
		magAc.signIn(DATA_USER1, DATA_PASS);
		/*Step Number: 1
		 *Step Name: Step 1: Open the wiki page
		 *Step Description: 
			- Open the wiki page PageA
			- Go to More 
			-
			-> Page Permissions
		 *Input Data: 

		 *Expected Outcome: 
			Page Permissions form displays*/

		/*Step number: 2
		 *Step Name: Step 2: Delete Edit Pages permission for Group A
		 *Step Description: 
			- Check the Group A permission
			- In the permission table, untick the Edit Pages checkbox of the Group A
			- Click Save
		 *Input Data: 

		 *Expected Outcome: 
			- Edit Pages checkbox is deselected*/
		goToWikiPage("Wiki Home/" + title, ManageAccount.userType.ADMIN);
		editPagePermission(path, true, true);
		magAc.signOut();

		/*Step number: 3
		 *Step Name: Step 3: Check if the Group A has Edit Pages permission
		 *Step Description: 
			- Login as user member of Group A
			- Go to space 
			-
			-> Wiki
			- Select the wiki page
		 *Input Data: 

		 *Expected Outcome: 
			- The user can view PageA but cannot see Edit Page, Add Page; Move Page and Delete Page from More menu*/
		magAc.signIn(user, DATA_PASS);
		goToWiki();
		goToWikiPage(title);
		waitForAndGetElement(ELEMENT_EDIT_PAGE_LINK);
		waitForAndGetElement(ELEMENT_ADD_PAGE_LINK);
		click(ELEMENT_MORE_LINK);
		waitForAndGetElement(ELEMENT_DELETE_LINK);
		waitForAndGetElement(ELEMENT_MOVE_PAGE_LINK);

		//Clear data
		info("Clear data");
		String[] wikiPath = {"Wiki Home/" + title};
		resetDataByDeleteWikiPage(ManageAccount.userType.ADMIN, wikiPath);

	}

	/**
	 *Case ID:113645.
	 *Test Case Name: Verify View permission for a user.
	 *Pre-Condition: - wiki page PageA already is created
	- User A has permissions on PageA: View Pages, Edit Pages in Page Permissions
	- User A does not belong to any group who has Edit Pages in Page Permissions
	 *Post-Condition: 
	 *Done with OSs and browsers : 
	 *Generated by phuongdt at 2014/09/18 14:17:25
	 */
	@Test
	public  void test03_VerifyViewPermissionForAUser() {
		info("Test 3: Verify View permission for a user");
		String title = "title113645";
		String content = "content113645";
		String new_content = "newcontent113645";
		By element_page = By.linkText(title);
		String user = DATA_USER3;
		String[] userGroup = {user};

		info("Add a wiki page");
		goToWiki();
		addBlankWikiPage(title, content, 0);

		info("Add user has permission default");
		deletePagePermission("any");
		waitForElementNotPresent(ELEMENT_PAGE_PERMISSION_POPUP);
		addPagePermission(1, userGroup);
		waitForElementNotPresent(ELEMENT_PAGE_PERMISSION_POPUP);

		info("Add edit page permission for " + user);
		editPagePermission(user, true, true);

		info("Check user can view/edit wiki page");
		magAc.signOut();
		magAc.signIn(user, DATA_PASS);
		checkViewEditPage(element_page, content, new_content);

		magAc.signOut();
		magAc.signIn(DATA_USER1, DATA_PASS);

		/*Step Number: 1
		 *Step Name: Step 1: Open Page Permissions form
		 *Step Description: 
			- Open the wiki page PageA
			- Go to More 
			-
			-> Page Permissions
		 *Input Data: 

		 *Expected Outcome: 
			Page Permissions form displays*/

		/*Step number: 2
		 *Step Name: Step 2: Delete Edit Pages permission for User A
		 *Step Description: 
			- Check the User A permission
			- In the permission table, untick the Edit Pages checkbox of the User A
			- Click Save
		 *Input Data: 

		 *Expected Outcome: 
			- Edit Pages checkbox is deselected*/
		goToWikiPage("Wiki Home/" + title, ManageAccount.userType.ADMIN);
		editPagePermission(user, true, false);
		magAc.signOut();

		/*Step number: 3
		 *Step Name: Step 3: Check if the User A has Edit Pages permission
		 *Step Description: 
			- Login as User A
			- Go to space 
			-
			-> Wiki
			- Select PageA
		 *Input Data: 

		 *Expected Outcome: 
			- The user A can view the wiki page PageA but cannot see Edit Page, Add Page; Move Page and Delete Page from More menu*/ 
		magAc.signIn(user, DATA_PASS);
		goToWiki();
		goToWikiPage(title);
		waitForElementNotPresent(ELEMENT_EDIT_PAGE_LINK);
		waitForElementNotPresent(ELEMENT_ADD_PAGE_LINK);
		click(ELEMENT_MORE_LINK);
		waitForElementNotPresent(ELEMENT_DELETE_LINK);
		waitForElementNotPresent(ELEMENT_MOVE_PAGE_LINK);

		//Clear data
		info("Clear data");
		String[] wikiPath = {"Wiki Home/" + title};
		resetDataByDeleteWikiPage(ManageAccount.userType.ADMIN, wikiPath);
	}

	/**
	 *Case ID:113646.
	 *Test Case Name: Verify View permission for a group.
	 *Pre-Condition: - wiki page PageA already is created
	- Group A already has permissions on the wiki page PageA: View Pages, Edit Pages in Page Permissions
	- Member of Group A does not belong to any groups who have Edit Pages permission in Page Permissions
	- Member of Group A does not have Edit Pages permission in Page Permissions
	 *Post-Condition: 
	 *Done with OSs and browsers : 
	 *Generated by phuongdt at 2014/09/18 14:17:25
	 */
	@Test
	public  void test04_VerifyViewPermissionForAGroup() {
		info("Test 4: Verify View permission for a group");
		String title = "title113647";
		String content = "content113647";
		String new_content = "newcontent113647";
		By element_page = By.linkText(title);
		String user = DATA_USER3;
		String path = "*:/organization/employees";
		String[] userGroup = {path};

		info("Add a wiki page");
		goToWiki();
		addBlankWikiPage(title, content, 0);

		info("Add user has permission default");
		deletePagePermission("any");
		waitForElementNotPresent(ELEMENT_PAGE_PERMISSION_POPUP);
		addPagePermission(0, userGroup);
		waitForElementNotPresent(ELEMENT_PAGE_PERMISSION_POPUP);

		info("Add edit page permission for " + user);
		editPagePermission(path, true, true);

		info("Check user can view/edit wiki page");
		magAc.signOut();
		magAc.signIn(user, DATA_PASS);
		checkViewEditPage(element_page, content, new_content);

		magAc.signOut();
		magAc.signIn(DATA_USER1, DATA_PASS);
		/*Step Number: 1
		 *Step Name: Step 1: Open the wiki page
		 *Step Description: 
			- Open the wiki page PageA
			- Go to More 
			-
			-> Page Permissions
		 *Input Data: 

		 *Expected Outcome: 
			Page Permissions form displays*/

		/*Step number: 2
		 *Step Name: Step 2: Delete Edit Pages permission for Group A
		 *Step Description: 
			- Check the Group A permission
			- In the permission table, untick the Edit Pages checkbox of the Group A
			- Click Save
		 *Input Data: 

		 *Expected Outcome: 
			- Edit Pages checkbox is deselected*/
		goToWikiPage("Wiki Home/" + title, ManageAccount.userType.ADMIN);
		editPagePermission(path, true, false);
		magAc.signOut();

		/*Step number: 3
		 *Step Name: Step 3: Check if the Group A has Edit Pages permission
		 *Step Description: 
			- Login as user member of Group A
			- Go to space 
			-
			-> Wiki
			- Select the wiki page
		 *Input Data: 

		 *Expected Outcome: 
			- The user can view PageA but cannot see Edit Page, Add Page; Move Page and Delete Page from More menu*/
		magAc.signIn(user, DATA_PASS);
		goToWiki();
		goToWikiPage(title);
		waitForElementNotPresent(ELEMENT_EDIT_PAGE_LINK);
		waitForElementNotPresent(ELEMENT_ADD_PAGE_LINK);
		click(ELEMENT_MORE_LINK);
		waitForElementNotPresent(ELEMENT_DELETE_LINK);
		waitForElementNotPresent(ELEMENT_MOVE_PAGE_LINK);

		//Clear data
		info("Clear data");
		String[] wikiPath = {"Wiki Home/" + title};
		resetDataByDeleteWikiPage(ManageAccount.userType.ADMIN, wikiPath);
	}
}